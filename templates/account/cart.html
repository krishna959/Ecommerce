{% extends "base/base.html" %}

{% load static %}
<img src="{% static 'image/logos.png' %}" alt="Logo" class="img-fluid">

{% block start %}
<section class="section-content padding-y bg">
  <div class="container">
    <div class="card">
      <div class="table-responsive">
        <table class="table table-borderless table-shopping-cart">
          <thead class="text-muted">
            <tr class="small text-uppercase">
              <th scope="col">Product</th>
              <th scope="col" width="120">Quantity</th>
              <th scope="col" width="120">Price</th>
              <th scope="col" class="text-right" width="200"></th>
            </tr>
          </thead>
          <tbody>
            {% if cart and cart.cart_items.all %}
              {% for item in cart.cart_items.all %}
                <tr>
                  <td>
                    <figure class="itemside align-items-center">
                      <div class="aside">
                        <img src="{{ item.product.product_image.first.image.url }}" class="img-sm">
                      </div>
                      <figcaption class="info">
                        <a href="{% url 'product' item.product.slug %}" class="title text-dark">{{ item.product.product_name }}</a>
                        <p class="text-muted small">
                          Size: {{ item.size_variant.size_name|default:"N/A" }},
                          Color: {{ item.color_variant.color_name|default:"N/A" }},
                          Brand: {{ item.product.brand|default:"Marvel" }}
                        </p>
                      </figcaption>
                    </figure>
                  </td>
                  <td>
                    <input type="number" class="form-control" name="quantity" value="{{ item.quantity }}" min="1">
                  </td>
                  <td>
                    <var class="price">
                      ${{ item.get_product_price|floatformat:2 }}
                    </var>
                    <small class="text-muted">${{ item.product.price|floatformat:2 }} each</small>
                  </td>
                  <td class="text-right">
                    <a href="{% url 'remove_cart' item.uid %}" class="btn btn-danger">Remove</a>
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="4" class="text-center">Your cart is empty</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      <div class="card-body border-top">
        <div class="d-flex justify-content-between">
          <div>
            <input type="text" class="form-control" placeholder="Coupon code">
            <button class="btn btn-primary mt-2">Apply</button>
          </div>
          <div class="text-right">
            <p>Total price: <strong>USD {{ cart.get_cart_total|floatformat:2 }}</strong></p>
            <p>Discount: <strong>USD {{ discount|floatformat:2 }}</strong></p>
            <h5>Total: <strong>USD {{ grand_total|floatformat:2 }}</strong></h5>
          </div>
        </div>
        <div class="mt-3 d-flex justify-content-between">
          <a href="{% url 'index' %}" class="btn btn-secondary">Continue Shopping</a>
          <button= id="rzp-button1" class="btn btn-primary">Make Purchase</button>
        </div>
      </div>
    </div>
    <div class="alert alert-success mt-3">Free Delivery within 1-2 weeks</div>
  </div>
</section>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  var options = {
      "key": "rzp_test_Vsu0thbzsU8dCz", // Enter the Key ID generated from the Dashboard
      "amount": "{{payment.amount}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "Ecomm",
      "description": "purchases",
      "image": "https://example.com/your_logo",
      "order_id": "{{payment.id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
          alert(response.razorpay_payment_id);
          alert(response.razorpay_order_id);
          alert(response.razorpay_signature)
      },
      
      
      "theme": {
          "color": "#3399cc"
      }
  };
  var rzp1 = new Razorpay(options);
  rzp1.on('payment.failed', function (response){
          alert(response.error.code);
          alert(response.error.description);
          alert(response.error.source);
          alert(response.error.step);
          alert(response.error.reason);
          alert(response.error.metadata.order_id);
          alert(response.error.metadata.payment_id);
  });
  document.getElementById('rzp-button1').onclick = function(e){
      rzp1.open();
      e.preventDefault();
  }
</script>
{% endblock %}
